import com.phone.versionplugin.BuildVersions

plugins {
    id 'com.android.library'
    id 'org.jetbrains.kotlin.android'
    //ARouteréœ€è¦ç”¨åˆ°
    id 'kotlin-kapt'
    id 'maven-publish'
    id 'com.phone.versionplugin'
}

afterEvaluate {
    publishing {
        publications {
            release(MavenPublication) {
                groupId = project.findProperty("GROUP_ID")   // ç»„ç»‡æ ‡è¯†
                artifactId = project.findProperty("ARTIFACT_ID")    // åº“åç§°
                version = project.findProperty("BASE64_LIBRARY_VERSION")           // ç‰ˆæœ¬å·

                // è‡ªåŠ¨å…³è” release ç‰ˆ AAR
//                from components.release
                // æŒ‡å®š AAR æ–‡ä»¶è·¯å¾„
                artifact("$rootDir/outputs/aars/${project.name}-release.aar")

                // æ·»åŠ æºç åŒ…ï¼ˆå¯é€‰ï¼‰
                artifact(sourcesJar)




                pom {
                    name = project.findProperty("ARTIFACT_ID")    // åº“åç§°
                    description = project.findProperty("ARTIFACT_ID")    // åº“åç§°
                    url = "https://maven.pkg.github.com/UrasakiNakajima/RxJava2AndRetrofit2"
                    licenses {
                        license {
                            name = "Apache-2.0"
                            url = "https://www.apache.org/licenses/LICENSE-2.0.txt"
                        }
                    }
                    developers {
                        developer {
                            id = project.findProperty("GROUP_ID")   // ç»„ç»‡æ ‡è¯†
                            name = "UrasakiNakajima"
                            email = "1164688204@qq.com"
                        }
                    }
                    scm {
                        connection = "scm:git:git://maven.pkg.github.com/UrasakiNakajima/RxJava2AndRetrofit2.git"
                        developerConnection = "scm:git:ssh://maven.pkg.github.com/UrasakiNakajima/RxJava2AndRetrofit2.git"
                        url = "https://maven.pkg.github.com/UrasakiNakajima/RxJava2AndRetrofit2"
                    }
                }


                // æ·»åŠ ä¾èµ–ä¼ é€’
                pom.withXml {
                    def dependenciesNode = asNode().appendNode('dependencies')

                    // æ·»åŠ  implementation ä¾èµ–
                    configurations.implementation.allDependencies.each { dep ->
                        if (dep.group != null && dep.name != null && dep.version != null) {
                            def dependencyNode = dependenciesNode.appendNode('dependency')
                            dependencyNode.appendNode('groupId', dep.group)
                            dependencyNode.appendNode('artifactId', dep.name)
                            dependencyNode.appendNode('version', dep.version)
                            dependencyNode.appendNode('scope', 'runtime') // æˆ– 'compile'
                        }
                    }
                }
            }
        }
        repositories {
            maven {
                name = "GitHubPackages"
                // ğŸ‘‡ å…³é”®URLæ ¼å¼ï¼ˆæ›¿æ¢ä¸¤ä¸ªYOUR_ï¼‰
                url = uri("https://maven.pkg.github.com/UrasakiNakajima/RxJava2AndRetrofit2")
                credentials {
                    username = project.findProperty("gpr.user") ?: System.getenv("GITHUB_USER")
                    password = project.findProperty("gpr.key") ?: System.getenv("GITHUB_TOKEN")
                }
            }
        }
    }

//    signing {
//        sign publishing.publications.release  // è‡ªåŠ¨ç­¾å
//    }
}

// åˆ›å»ºæºç JARä»»åŠ¡
task sourcesJar(type: Jar) {
    from android.sourceSets.main.java.srcDirs
    archiveClassifier = 'sources'
}

android {
    compileSdk BuildVersions.compileSdk

    defaultConfig {
        minSdk BuildVersions.minSdk
        targetSdk BuildVersions.targetSdk
        versionCode BuildVersions.versionCode
        versionName BuildVersions.versionName
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        consumerProguardFiles "consumer-rules.pro"

        javaCompileOptions {
            annotationProcessorOptions {
                arguments = [AROUTER_MODULE_NAME: project.getName()]
            }
        }
        kapt {
            arguments {
                arg("AROUTER_MODULE_NAME", project.getName())
            }
        }
    }

//    buildTypes {
//        release {
//            //javaä»£ç ä¸­å¼•ç”¨çš„å®šä¹‰å½¢å¼
//            buildConfigField "Boolean", "IS_MODULE", "${isModule}"
//            buildConfigField "Boolean", "IS_RELEASE", "${isRelease}"
//            minifyEnabled false
//            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
//        }
//        debug {
//            //javaä»£ç ä¸­å¼•ç”¨çš„å®šä¹‰å½¢å¼
//            buildConfigField "Boolean", "IS_MODULE", "${isModule}"
//            buildConfigField "Boolean", "IS_RELEASE", "${isRelease}"
//            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
//        }
//    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    sourceSets {
        main {
            jniLibs.srcDirs = ['libs']
            manifest.srcFile 'src/main/java/library/AndroidManifest.xml'
        }
    }
    //ç»™Module å†…çš„èµ„æºåå¢åŠ å‰ç¼€, é¿å…èµ„æºåå†²çª
    resourcePrefix "base64_"
}

dependencies {
    implementation project(path: ':library_common')
    implementation project(path: ':library_mvp')
    implementation "id.zelory:compressor:$BuildVersions.compressor_version"
    //Androidè·¯ç”±ï¼ˆç”¨äºä¸åŒappä¹‹é—´çš„è·³è½¬ï¼‰
//    implementation "com.alibaba:arouter-api:$BuildVersions.arouter_api_version"
    kapt "com.alibaba:arouter-compiler:$BuildVersions.arouter_compiler_version"

    //é˜¿é‡Œäº‘Osså¯¹è±¡å­˜å‚¨
    implementation "com.aliyun.dpa:oss-android-sdk:$BuildVersions.oss_android_sdk_version"

}